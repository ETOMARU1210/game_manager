<!-- filepath: /Users/horiuchiinori/game_manager/app/views/layouts/_chat_room.html.erb -->
<div class="d-flex flex-column" style="height: 100vh;">
  <!-- チャットルームヘッダー -->
  <div class="p-3 border-bottom bg-white d-flex align-items-center justify-content-between">
    <h5 class="mb-0 text-dark"><i class="bi bi-chat-dots"></i> チャットルーム</h5>
    <div class="d-block d-md-none">
      <button class="btn btn-outline-primary me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#leftOffcanvas" aria-controls="leftOffcanvas">
        <i class="bi bi-list"></i> タスク管理
      </button>
      <button class="btn btn-outline-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#rightOffcanvas" aria-controls="rightOffcanvas">
        <i class="bi bi-info-circle"></i> タスクについて
      </button>
    </div>
  </div>
  <!-- チャットメッセージ表示エリア（ここだけスクロール） -->
  <div class="flex-grow-1 overflow-auto p-3 bg-light d-flex flex-column" id="chat-messages" style="min-height:0;">
    <div class="mt-auto">
      <% @posts.each do |post| %>
        <div class="mb-2 d-flex">
          <div class="bg-white rounded px-3 py-2 shadow-sm" style="max-width: 70%;">
            <span class="fw-bold text-primary"><%= post.user&.name || "名無し" %></span>
            <div class="text-break"><%= post.comment %></div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <!-- メッセージ入力フォーム -->
  <div class="p-3 border-top bg-white">
    <%= form_with model: @post do |form| %>
      <div class="input-group">
        <%= form.text_area :comment, class: "form-control", placeholder: "メッセージを入力...", id: "chat-input", rows: 3, style: "resize:vertical; min-height:48px; max-height:150px;" %>
        <%= form.submit "送信", class: "btn btn-primary", id: "send-button" do %>
            <i class="bi bi-send"></i> 送信
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener("turbo:load", function() {
    var chatMessages = document.getElementById("chat-messages");
    if(chatMessages) {
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  });
</script>
